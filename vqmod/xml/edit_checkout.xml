<modification>

	<id>Edit Checkout</id>
	<version>300.1</version>
	<vqmver>2.6.2</vqmver>

    <file name="catalog/language/en-gb/checkout/checkout.php">
		<operation>
            <search position="replace"><![CDATA[
            $_['text_checkout_shipping_address'] = 'Step %s: Delivery Details';
            ]]></search>
            <add><![CDATA[
            $_['text_checkout_shipping_address'] = 'Step %s: Customer Details';
            ]]></add>
        </operation>
    </file>>

    <file name="catalog/controller/checkout/checkout.php">
		<operation>
            <search position="replace" offset="12"><![CDATA[
            $data['text_checkout_option'] = sprintf($this->language->get('text_checkout_option'), 1);
            ]]></search>
            <add><![CDATA[
            $data['text_checkout_shipping_address'] = sprintf($this->language->get('text_checkout_shipping_address'), 1);
		    $data['text_checkout_shipping_method'] = sprintf($this->language->get('text_checkout_shipping_method'), 2);
            $data['text_checkout_payment_method'] = sprintf($this->language->get('text_checkout_payment_method'), 3);
			$data['text_checkout_confirm'] = sprintf($this->language->get('text_checkout_confirm'), 4);
            ]]></add>
        </operation>

        <operation>
            <search position="replace"><![CDATA[
            $this->response->setOutput($this->load->view('checkout/checkout', $data));
            ]]></search>
            <add><![CDATA[
            $this->response->setOutput($this->load->view('checkout/new_checkout', $data));
            ]]></add>
        </operation>
    
    </file>

   <file name="catalog/controller/checkout/payment_method.php">
        <operation>
            <search position="replace"><![CDATA[
            if (isset($this->session->data['payment_address'])) {
            ]]></search>
            <add><![CDATA[
            if (isset($this->session->data['shipping_address'])) {
            ]]></add>
        </operation>

        <operation>
            <search position="replace"><![CDATA[
            $method = $this->{'model_extension_payment_' . $result['code']}->getMethod($this->session->data['payment_address'], $total);
            ]]></search>
            <add><![CDATA[
            $method = $this->{'model_extension_payment_' . $result['code']}->getMethod($this->session->data['shipping_address'], $total);
            ]]></add>
        </operation>

        <operation>
            <search position="replace"><![CDATA[
            if (!isset($this->session->data['payment_address'])) {
            ]]></search>
            <add><![CDATA[
            if (!isset($this->session->data['shipping_address'])) {
            ]]></add>
        </operation>
    </file>

     <file name="catalog/controller/checkout/confirm.php">
        <operation>
            <search position="replace" offset="3"><![CDATA[
            // Validate if payment address has been set.
            ]]></search>
            <add><![CDATA[
            ]]></add>
        </operation>

        <operation>
            <search position="replace" offset="12"><![CDATA[
            $order_data['payment_firstname'] = $this->session->data['payment_address']['firstname'];
            ]]></search>
            <add><![CDATA[
            ]]></add>
        </operation>
    </file>

    <file name="catalog\view\theme\basf\template\checkout\payment_method.twig">
        <operation>
            <search position="replace" offset="2"><![CDATA[
            <p>{{ text_payment_method }}</p>
            ]]></search>
            <add><![CDATA[
            <!-- {% for payment_method in payment_methods %}
            <div class="radio" style="display:none"> -->
            ]]></add>
        </operation>
    </file>

    <file name="catalog/model/checkout/order.php">
		<operation>
            <search position="replace" offset="1"><![CDATA[
            public function addOrder($data) {
            ]]></search>
            <add><![CDATA[
            public function addOrder($data) {
            $this->db->query("INSERT INTO `" . DB_PREFIX . "order` SET invoice_prefix = '" . $this->db->escape($data['invoice_prefix']) . "', store_id = '" . (int)$data['store_id'] . "', store_name = '" . $this->db->escape($data['store_name']) . "', store_url = '" . $this->db->escape($data['store_url']) . "', customer_id = '" . (int)$data['customer_id'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', custom_field = '" . $this->db->escape(isset($data['custom_field']) ? json_encode($data['custom_field']) : '') . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "', shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($data['shipping_country']) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($data['shipping_zone']) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($data['shipping_address_format']) . "', shipping_custom_field = '" . $this->db->escape(isset($data['shipping_custom_field']) ? json_encode($data['shipping_custom_field']) : '') . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', total = '" . (float)$data['total'] . "', affiliate_id = '" . (int)$data['affiliate_id'] . "', commission = '" . (float)$data['commission'] . "', marketing_id = '" . (int)$data['marketing_id'] . "', tracking = '" . $this->db->escape($data['tracking']) . "', language_id = '" . (int)$data['language_id'] . "', currency_id = '" . (int)$data['currency_id'] . "', currency_code = '" . $this->db->escape($data['currency_code']) . "', currency_value = '" . (float)$data['currency_value'] . "', ip = '" . $this->db->escape($data['ip']) . "', forwarded_ip = '" .  $this->db->escape($data['forwarded_ip']) . "', user_agent = '" . $this->db->escape($data['user_agent']) . "', accept_language = '" . $this->db->escape($data['accept_language']) . "', date_added = NOW(), date_modified = NOW()");
            ]]></add>
        </operation>
    </file>


</modification>